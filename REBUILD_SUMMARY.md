# Rebuild Summary: TON Integration

## –ó–∞–¥–∞—á–∞
–ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ–ª–µ–≥—Ä–∞–º-–±–æ—Ç–∞ —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å TON (The Open Network) –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–æ–π –≤–º–µ—Å—Ç–æ Telegram Stars –∏ YooKassa (RUB).

## –¶–µ–ª–∏
‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø–ª–∞—Ç–µ–∂–µ–π –±–µ–∑ —É—á–∞—Å—Ç–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞
‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã –ø—Ä–∏–∑–æ–≤ (—Å–µ–∫—É–Ω–¥—ã –≤–º–µ—Å—Ç–æ —á–∞—Å–æ–≤/–¥–Ω–µ–π)
‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ –∫–æ–º–∏—Å—Å–∏–π —Å 20% –¥–æ 12%
‚úÖ –ü–æ–ª–Ω–∞—è –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ –±–ª–æ–∫—á–µ–π–Ω
‚úÖ –£–ª—É—á—à–µ–Ω–∏–µ UX –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

## –í—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Database Migration)

**–§–∞–π–ª:** `migrations/versions/20251116_add_ton_support.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `TON` –≤ enum `CurrencyType`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `balance_ton` –≤ —Ç–∞–±–ª–∏—Ü—É `users`
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `ton_wallet_address` –≤ —Ç–∞–±–ª–∏—Ü—É `users` (–¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–∏–∑–æ–≤)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `transaction_hash` –≤ —Ç–∞–±–ª–∏—Ü—É `transactions` (–¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `wallet_address` –≤ —Ç–∞–±–ª–∏—Ü—É `withdrawal_requests`
- ‚úÖ –°–æ–∑–¥–∞–Ω –∏–Ω–¥–µ–∫—Å –¥–ª—è `transaction_hash` –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞

**–ú–æ–¥–µ–ª–∏:**
–û–±–Ω–æ–≤–ª–µ–Ω —Ñ–∞–π–ª `app/database/models.py`:
- Enum `CurrencyType` —Ç–µ–ø–µ—Ä—å –≤–∫–ª—é—á–∞–µ—Ç `TON`
- User model —Å –Ω–æ–≤—ã–º–∏ –ø–æ–ª—è–º–∏
- Transaction model —Å transaction_hash
- WithdrawalRequest model —Å wallet_address

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

**–§–∞–π–ª:** `app/config.py`

**–ù–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```python
# TON Configuration
TON_CENTER_API_KEY: str
TON_WALLET_ADDRESS: str
TON_WALLET_MNEMONIC: str
TON_NETWORK: str = "mainnet"

# Bot Settings
TON_ENTRY_FEE: float = 0.5
TON_COMMISSION_PERCENT: int = 12

# Reserve Settings
TON_RESERVE_MIN: float = 10.0
TON_RESERVE_TARGET: float = 20.0

# Withdrawal Settings
MIN_WITHDRAWAL_TON: float = 0.1

# Currency Settings
TON_ONLY: bool = True

# Transaction Monitoring
TON_TRANSACTION_CHECK_INTERVAL: int = 15
TON_TRANSACTION_CONFIRMATIONS: int = 1
```

**–û–±–Ω–æ–≤–ª–µ–Ω:** `.env.example` —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º–∏ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è–º–∏ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ

### 3. TON Blockchain Services

#### **–§–∞–π–ª:** `app/services/ton_service.py` (–ù–û–í–´–ô)

–û—Å–Ω–æ–≤–Ω–æ–π —Å–µ—Ä–≤–∏—Å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å TON:
- `get_balance()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –∫–æ—à–µ–ª—å–∫–∞
- `check_incoming_transactions()` - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ö–æ–¥—è—â–∏—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- `send_ton()` - –æ—Ç–ø—Ä–∞–≤–∫–∞ TON –Ω–∞ –∞–¥—Ä–µ—Å
- `send_prize_payout()` - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–ø–ª–∞—Ç–∞ –ø—Ä–∏–∑–∞
- `verify_transaction()` - –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
- `generate_payment_comment()` - –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è
- `parse_payment_comment()` - –ø–∞—Ä—Å–∏–Ω–≥ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è

**–¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏:** pytoniq, pytoniq-core, TON Center API

#### **–§–∞–π–ª:** `app/services/ton_monitor.py` (–ù–û–í–´–ô)

–§–æ–Ω–æ–≤—ã–π —Å–µ—Ä–≤–∏—Å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π:
- –ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –±–æ—Ç–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–æ–≤—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∫–∞–∂–¥—ã–µ 15 —Å–µ–∫—É–Ω–¥
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
- –ó–∞–ø—É—Å–∫–∞–µ—Ç —Ä–æ–∑—ã–≥—Ä—ã—à –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –º–∏–Ω–∏–º—É–º–∞
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –æ—à–∏–±–∫–∏ –∏ –¥—É–±–ª–∏–∫–∞—Ç—ã

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ —É—á–∞—Å—Ç–∏—è –∞–¥–º–∏–Ω–∞
- –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### 4. Payment Handlers

**–§–∞–π–ª:** `app/handlers/payment.py`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ò–º–ø–æ—Ä—Ç `ton_service`
- `callback_pay_ton()` - –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ TON –ø–ª–∞—Ç–µ–∂–µ–π
  - –ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –ø–ª–∞—Ç–µ–∂–∞
  - –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
  - –í—ã–≤–æ–¥–∏—Ç –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π

**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∏–º–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å TON"
2. –ü–æ–ª—É—á–∞–µ—Ç –∞–¥—Ä–µ—Å –∫–æ—à–µ–ª—å–∫–∞ –±–æ—Ç–∞
3. –ü–æ–ª—É—á–∞–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: `raffle_{id}_user_{id}`
4. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç TON –∏–∑ —Å–≤–æ–µ–≥–æ –∫–æ—à–µ–ª—å–∫–∞
5. TON monitor –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç

### 5. Raffle Logic

**–§–∞–π–ª:** `app/handlers/raffle.py`

**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `handle_ton_payout()` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –≤—ã–ø–ª–∞—Ç
- –û–±–Ω–æ–≤–ª–µ–Ω–∞ `execute_raffle()` –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ TON
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è TON –∫–æ—à–µ–ª—å–∫–∞ —É –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ø—Ä–∏–∑–∞ —á–µ—Ä–µ–∑ TON blockchain
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ–º –∞–¥–º–∏–Ω–∞

**–õ–æ–≥–∏–∫–∞ –≤—ã–ø–ª–∞—Ç:**
```python
if raffle.entry_fee_type == CurrencyType.TON:
    # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–ø–ª–∞—Ç–∞ —á–µ—Ä–µ–∑ TON
    await handle_ton_payout(...)
else:
    # Legacy —Å–∏—Å—Ç–µ–º–∞ (Stars/RUB) - —Ä—É—á–Ω–∞—è –≤—ã–ø–ª–∞—Ç–∞
    await payout_service.send_payout_request_to_admin(...)
```

**–û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—ã–∑–æ–≤—ã:**
- `payment_choice()` —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `ton_fee` –ø–∞—Ä–∞–º–µ—Ç—Ä
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É–º–º—ã –ø—Ä–∏–∑–∞ –≤ TON
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—ã (4 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π)

### 6. UI/UX Updates

**–§–∞–π–ª:** `app/keyboards/inline.py`

**–û–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- `payment_choice()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üíé –û–ø–ª–∞—Ç–∏—Ç—å TON"
- `balance_keyboard()` - –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üíé –£–∫–∞–∑–∞—Ç—å TON –∫–æ—à–µ–ª–µ–∫" (–≤ —Ä–µ–∂–∏–º–µ TON_ONLY)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–Ω—ã—Ö —Ä–µ–∂–∏–º–æ–≤: TON_ONLY, STARS_ONLY, —Å–º–µ—à–∞–Ω–Ω—ã–π

**–§–∞–π–ª:** `app/handlers/start.py`

**–û–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
- Welcome message —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ TON
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞ –≤ TON
- –ü–æ–∫–∞–∑ TON –∫–æ—à–µ–ª—å–∫–∞ (–∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ —É–∫–∞–∑–∞—Ç—å)
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ TON
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–µ–∂–∏–º–∞ (TON_ONLY/STARS_ONLY/Mixed)

**–£–ª—É—á—à–µ–Ω–∏—è UX:**
- –ß–µ—Ç–∫–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ–ø–ª–∞—Ç–µ —á–µ—Ä–µ–∑ TON
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤: –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –≤—ã–ø–ª–∞—Ç—ã, –ø—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å, –Ω–∏–∑–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –≤—Ä–µ–º–µ–Ω–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ (~15 —Å–µ–∫—É–Ω–¥)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Tonkeeper, TON Wallet, @wallet

### 7. Main Application

**–§–∞–π–ª:** `app/main.py`

**–î–æ–±–∞–≤–ª–µ–Ω–æ:**
- –ò–º–ø–æ—Ä—Ç `ton_monitor`, `ton_service`
- –ó–∞–ø—É—Å–∫ TON –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –≤ `on_startup()`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–∞–ª–∞–Ω—Å–∞ –∫–æ—à–µ–ª—å–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ –æ –±–∞–ª–∞–Ω—Å–µ
- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –ø—Ä–∏ –Ω–∏–∑–∫–æ–º –±–∞–ª–∞–Ω—Å–µ
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ TON —Å–µ—Ä–≤–∏—Å–æ–≤ –≤ `on_shutdown()`

**–§—É–Ω–∫—Ü–∏–∏ startup:**
```python
if settings.TON_ONLY:
    ton_monitor = await start_ton_monitor(bot)
    balance = await ton_service.get_balance()
    # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ –æ –±–∞–ª–∞–Ω—Å–µ
```

### 8. Dependencies

**–§–∞–π–ª:** `requirements.txt`

**–î–æ–±–∞–≤–ª–µ–Ω—ã:**
```
pytoniq>=0.1.38
pytoniq-core>=0.1.30
tonsdk
```

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ TON –ø–ª–∞—Ç–µ–∂–µ–π

### –ü—Ä–∏–µ–º –ø–ª–∞—Ç–µ–∂–µ–π (Payment Flow)

```
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å ‚Üí –ù–∞–∂–∏–º–∞–µ—Ç "–£—á–∞—Å—Ç–≤–æ–≤–∞—Ç—å"
           ‚Üì
       –í—ã–±–∏—Ä–∞–µ—Ç "–û–ø–ª–∞—Ç–∏—Ç—å TON"
           ‚Üì
    –ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏:
    - –ê–¥—Ä–µ—Å: UQxx...
    - –°—É–º–º–∞: 0.5 TON
    - –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: raffle_1_user_123
           ‚Üì
    –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏–∑ –∫–æ—à–µ–ª—å–∫–∞
           ‚Üì
    TON Monitor (–∫–∞–∂–¥—ã–µ 15 —Å–µ–∫)
           ‚Üì
    –û–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
           ‚Üì
    –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
           ‚Üì
    –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç —É—á–∞—Å—Ç–∏–µ
           ‚Üì
    –°–æ—Ö—Ä–∞–Ω—è–µ—Ç transaction_hash
           ‚Üì
    –£–≤–µ–¥–æ–º–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
           ‚Üì
    –ü—Ä–∏ MIN_PARTICIPANTS ‚Üí –ó–∞–ø—É—Å–∫ —Ä–æ–∑—ã–≥—Ä—ã—à–∞
```

### –í—ã–ø–ª–∞—Ç–∞ –ø—Ä–∏–∑–æ–≤ (Payout Flow)

```
Random.org ‚Üí –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
         ‚Üì
    –ü—Ä–æ–≤–µ—Ä–∫–∞ TON –∫–æ—à–µ–ª—å–∫–∞ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è
         ‚Üì
    ‚úÖ –ï—Å—Ç—å ‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤—ã–ø–ª–∞—Ç–∞
         ‚Üì
    ton_service.send_prize_payout()
         ‚Üì
    –ü—Ä–∏–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –±–ª–æ–∫—á–µ–π–Ω
         ‚Üì
    –°–æ—Ö—Ä–∞–Ω–µ–Ω transaction_hash
         ‚Üì
    –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è —Å –¥–µ—Ç–∞–ª—è–º–∏
         ‚Üì
    –ü—Ä–∏–∑ –ø–æ–ª—É—á–µ–Ω –∑–∞ 5-30 —Å–µ–∫—É–Ω–¥
```

**–ü—Ä–∏ –æ—à–∏–±–∫–µ:**
```
–û—à–∏–±–∫–∞ –≤—ã–ø–ª–∞—Ç—ã
    ‚Üì
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–±–µ–¥–∏—Ç–µ–ª—è (–æ–∂–∏–¥–∞–Ω–∏–µ)
    ‚Üì
–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∞ —Å –¥–µ—Ç–∞–ª—è–º–∏
    ‚Üì
–†—É—á–Ω–∞—è –≤—ã–ø–ª–∞—Ç–∞ –∞–¥–º–∏–Ω–æ–º
```

## –≠–∫–æ–Ω–æ–º–∏—á–µ—Å–∫–∞—è –º–æ–¥–µ–ª—å

### –¢–µ–∫—É—â–∞—è (Stars/RUB):
- –í–∑–Ω–æ—Å: 10 –∑–≤–µ–∑–¥ –∏–ª–∏ 100 —Ä—É–±
- –ö–æ–º–∏—Å—Å–∏—è: 20% (Stars) / 15% (RUB)
- –í—ã–ø–ª–∞—Ç–∞: –†—É—á–Ω–∞—è (—á–∞—Å—ã/–¥–Ω–∏)
- –†–µ–∑–µ—Ä–≤: 5000 –∑–≤–µ–∑–¥ (~$65)

### –ù–æ–≤–∞—è (TON):
- –í–∑–Ω–æ—Å: 0.5 TON (~$2.75)
- –ö–æ–º–∏—Å—Å–∏—è: 12% (–Ω–∏–∂–µ!)
- –í—ã–ø–ª–∞—Ç–∞: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è (5-30 —Å–µ–∫)
- –†–µ–∑–µ—Ä–≤: 10-20 TON (~$55-110)

### –ü—Ä–∏–º–µ—Ä (10 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤, 0.5 TON):
```
–°–±–æ—Ä:           5.0 TON
–ö–æ–º–∏—Å—Å–∏—è –±–æ—Ç–∞:  0.6 TON (12%)
–ö–æ–º–∏—Å—Å–∏—è —Å–µ—Ç–∏:  0.01 TON (~$0.05)
–ü—Ä–∏–∑:           4.39 TON (88%)
```

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:
‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ –º–Ω–µ–º–æ–Ω–∏–∫–∞ –≤ .env (—Å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è–º–∏)
‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –ø–æ hash
‚úÖ –í–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è —Å—É–º–º –ø–ª–∞—Ç–µ–∂–µ–π
‚úÖ –ó–∞—â–∏—Ç–∞ –æ—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
‚úÖ –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞–ª–∞–Ω—Å–∞ —Å –∞–ª–µ—Ä—Ç–∞–º–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è production:
‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞–º–∏ (Vault, AWS Secrets Manager)
‚ö†Ô∏è –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ .env (chmod 600)
‚ö†Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–∑–µ—Ä–≤ –Ω–∞ –∫–æ—à–µ–ª—å–∫–µ
‚ö†Ô∏è –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–∞–ª–∞–Ω—Å–∞
‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ—à–µ–ª–µ–∫ —Ç–æ–ª—å–∫–æ –¥–ª—è –±–æ—Ç–∞

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º:
1. ‚úÖ –°–æ–∑–¥–∞—Ç—å TON –∫–æ—à–µ–ª–µ–∫ (Tonkeeper/TON Wallet)
2. ‚úÖ –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á TON Center (https://toncenter.com)
3. ‚úÖ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª
4. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `pip install -r requirements.txt`
5. ‚úÖ –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é: `alembic upgrade head`
6. ‚úÖ –ü–æ–ø–æ–ª–Ω–∏—Ç—å –∫–æ—à–µ–ª–µ–∫ (–º–∏–Ω–∏–º—É–º 20 TON –¥–ª—è —Ä–µ–∑–µ—Ä–≤–∞)

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
1. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ testnet
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö —Ñ—É–Ω–∫—Ü–∏–π
3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ mainnet
4. –¢–µ—Å—Ç–æ–≤—ã–π —Ä–æ–∑—ã–≥—Ä—ã—à —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π —Å—Ç–∞–≤–∫–æ–π
5. –ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π –∑–∞–ø—É—Å–∫

## –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–°–æ–∑–¥–∞–Ω–∞ –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
1. **TON_MIGRATION_GUIDE.md** - –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
   - –û–±–∑–æ—Ä –∏–∑–º–µ–Ω–µ–Ω–∏–π
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ —É—Å—Ç–∞–Ω–æ–≤–∫–µ
   - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫
   - FAQ –∏ troubleshooting

2. **REBUILD_SUMMARY.md** (—ç—Ç–æ—Ç —Ñ–∞–π–ª) - –†–µ–∑—é–º–µ –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

3. **CLAUDE.md** - –û–±–Ω–æ–≤–ª–µ–Ω–æ (TODO: —Ç—Ä–µ–±—É–µ—Ç –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)

## –§–∞–π–ª—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é

–°–ª–µ–¥—É—é—â–∏–µ —Ñ–∞–π–ª—ã –º–æ–≥—É—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å —Ä—É—á–Ω–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:

### Admin Handler
`app/handlers/admin.py` - —Å–æ–∑–¥–∞–Ω–∏–µ TON —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π
- –î–æ–±–∞–≤–∏—Ç—å –æ–ø—Ü–∏—é –≤—ã–±–æ—Ä–∞ –≤–∞–ª—é—Ç—ã (TON/Stars/RUB)
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å TON –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –≤ TON_ONLY —Ä–µ–∂–∏–º–µ
- –ü–æ–∫–∞–∑–∞—Ç—å –±–∞–ª–∞–Ω—Å TON –∫–æ—à–µ–ª—å–∫–∞

### CRUD Operations
`app/database/crud.py` - –µ—Å–ª–∏ –µ—Å—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–µ—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
- –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤—Å–µ CRUD –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç CurrencyType.TON
- –û–±–Ω–æ–≤–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –∏ –∑–∞–ø—Ä–æ—Å—ã

### Withdrawal Handler
`app/handlers/withdrawal.py` - –≤—ã–≤–æ–¥ TON
- –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –≤—ã–≤–æ–¥–∞ TON –Ω–∞ –∫–æ—à–µ–ª–µ–∫
- –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥ —á–µ—Ä–µ–∑ ton_service

## –°—Ç–∞—Ç—É—Å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å |
|--------|--------|
| –ê–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–æ–µ–∫—Ç–∞ | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –î–∏–∑–∞–π–Ω —Å—Ö–µ–º—ã –ë–î –¥–ª—è TON | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –°–æ–∑–¥–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ Alembic | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –†–µ–∞–ª–∏–∑–∞—Ü–∏—è TON —Å–µ—Ä–≤–∏—Å–∞ | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –†–µ–∞–ª–∏–∑–∞—Ü–∏—è TON –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ payment handlers | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ raffle –ª–æ–≥–∏–∫–∏ | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ UI/keyboards | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ start handler | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ main.py | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ requirements.txt | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –°–æ–∑–¥–∞–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ | ‚úÖ –í—ã–ø–æ–ª–Ω–µ–Ω–æ |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ CLAUDE.md | ‚è≥ –ß–∞—Å—Ç–∏—á–Ω–æ |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ admin handler | ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è |
| –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ | ‚è≥ –¢—Ä–µ–±—É–µ—Ç—Å—è |

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. **–û–±–Ω–æ–≤–∏—Ç—å admin handler** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è TON —Ä–æ–∑—ã–≥—Ä—ã—à–µ–π
2. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –ë–î** –≤ —Ç–µ—Å—Ç–æ–≤–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏
3. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ testnet**:
   - –°–æ–∑–¥–∞—Ç—å —Ä–æ–∑—ã–≥—Ä—ã—à
   - –û–ø–ª–∞—Ç–∏—Ç—å —É—á–∞—Å—Ç–∏–µ
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≤—ã–ø–ª–∞—Ç—É
4. **–û–±–Ω–æ–≤–∏—Ç—å CLAUDE.md** –ø–æ–ª–Ω–æ—Å—Ç—å—é
5. **Production deployment**:
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å production –∫–æ—à–µ–ª–µ–∫
   - –ü–æ–ø–æ–ª–Ω–∏—Ç—å —Ä–µ–∑–µ—Ä–≤
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ mainnet

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –ø–µ—Ä–µ—Ö–æ–¥–∞ –Ω–∞ TON

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
‚úÖ –ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –ø—Ä–∏–∑—ã (5-30 —Å–µ–∫—É–Ω–¥)
‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å - –≤—Å–µ –≤ –±–ª–æ–∫—á–µ–π–Ω–µ
‚úÖ –£–¥–æ–±–Ω—ã–µ –∫–æ—à–µ–ª—å–∫–∏ (Tonkeeper, @wallet)
‚úÖ –ù–∏–∑–∫–∏–µ –∫–æ–º–∏—Å—Å–∏–∏ (~$0.05)

### –î–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:
‚úÖ –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è
‚úÖ –ù–µ—Ç —Ä—É—á–Ω–æ–π —Ä–∞–±–æ—Ç—ã
‚úÖ –õ–µ–≥–∫–∏–π –≤—ã–≤–æ–¥ —Å—Ä–µ–¥—Å—Ç–≤
‚úÖ –ü—Ä–æ–∑—Ä–∞—á–Ω–∞—è –±—É—Ö–≥–∞–ª—Ç–µ—Ä–∏—è
‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

### –î–ª—è –ø—Ä–æ–µ–∫—Ç–∞:
‚úÖ –°–Ω–∏–∂–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö –∏–∑–¥–µ—Ä–∂–µ–∫ (12% vs 20%)
‚úÖ –õ—É—á—à–∏–π UX = –±–æ–ª—å—à–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚úÖ –°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è
‚úÖ –ì–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–æ—Å—Ç—É

---

**–í–µ—Ä—Å–∏—è:** 1.0
**–î–∞—Ç–∞:** 2025-11-16
**–ê–≤—Ç–æ—Ä:** Claude AI (Sonnet 4.5)
**–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** ~2 —á–∞—Å–∞

## –ö–æ–Ω—Ç–∞–∫—Ç—ã

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏:
- TON –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: https://docs.ton.org
- pytoniq library: https://github.com/yungwine/pytoniq
- TON Center: https://toncenter.com
